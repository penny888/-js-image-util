/*
* 图片工具类
* 图片压缩缩放
* ImageUtil.compress({
*   file: file, // 需要压缩的图片文件对象
*   quality: quality, // 压缩质量（可选）
*   scale: scale, // 缩放比例（可选）
*   target: target, // 显示图片的img目标元素（可选）
*   callback: callback, // 回调函数（当target不为空时可选）
*   rotateDirection: rotateDirection, // 旋转方向 'left' 'right'
*   rotateTimes: rotateTimes // 旋转次数
* });
* 图片旋转
* ImageUtil.rotate({
*   img: img, // 需要旋转的图片元素
*   direction: direction, // 旋转方向 'left' 'right'
*   times: times, // 旋转次数
*   canvas: canvas // 旋转画布（可选）
* });
*
* */

!function(l){var h=l.document;l.ImageUtil={compress:function(a){var d=this;if(a.file)if(/^image\/\w+/.test(a.file.type)){var b=new FileReader,f=a.file.type,e=a.scale||1;b.onload=function(){var c=new Image;c.onload=function(){function c(a,b){a.target?(a.target.src=b,a.callback&&a.callback(b)):a.callback?a.callback(b):alert("\u56de\u8c03\u51fd\u6570\u4e0d\u80fd\u4e3a\u7a7a")}var b=h.createElement("canvas");b.width=this.width*e;b.height=this.height*e;b.getContext("2d").drawImage(this,0,0,b.width,b.height);
        var g=b.toDataURL(f,a.quality||.7);a.rotateDirection&&a.rotateTimes?(b=new Image,b.src=g,b.onload=function(){var b=h.createElement("canvas");d.rotate({img:this,direction:a.rotateDirection,times:a.rotateTimes,canvas:b});g=b.toDataURL(f,a.quality||.7);c(a,g)}):c(a,g)};c.src=this.result};b.readAsDataURL(a.file)}else alert("\u6587\u4ef6\u7c7b\u578b\u5fc5\u987b\u4e3a\u56fe\u7247");else alert("\u8bf7\u4f20\u5165\u56fe\u7247\u6587\u4ef6\u5bf9\u8c61")},rotate:function(a){var d=a.canvas||h.createElement("canvas");
        if(a.img){for(var b=a.img.height,f=a.img.width,e=0,c=0;c<a.times;c++)"right"===a.direction?(e++,3<e&&(e=0)):(e--,0>e&&(e=3));c=d.getContext("2d");var k=90*e*Math.PI/180;switch(e){case 0:d.width=f;d.height=b;c.drawImage(a.img,0,0);break;case 1:d.width=b;d.height=f;c.rotate(k);c.drawImage(a.img,0,-b);break;case 2:d.width=f;d.height=b;c.rotate(k);c.drawImage(a.img,-f,-b);break;case 3:d.width=b,d.height=f,c.rotate(k),c.drawImage(a.img,-f,0)}return d}alert("\u8bf7\u4f20\u5165\u56fe\u7247\u5143\u7d20")}}}(window);